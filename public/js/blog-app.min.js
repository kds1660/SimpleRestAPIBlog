app.directive("whenScrolled",["$window",function(e){function t(){var e=document;return Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))}return function(o,i,n){i[0];angular.element(e).bind("scroll",function(){t()<=e.pageYOffset+e.innerHeight+2&&o.$apply(n.whenScrolled)})}}]),app.directive("fileread",[function(){return{scope:{fileread:"="},link:function(e,t,o){t.bind("change",function(t){var o=new FileReader;o.onload=function(t){e.$apply(function(){e.fileread=t.target.result})},o.readAsDataURL(t.target.files[0])})}}}]),app.controller("mainController",["$scope","$timeout","requestService",function(e,t,o){e.isLogged=0,e.alert={},e.alert.text="s",e.setName=function(t){e.isLogged=t},e.setAllert=function(o,i){console.log(o,i),o===!0&&(e.allertTrue=!0,e.alert.text=i),o===!1&&(e.allertFalse=!0,e.alert.text=i),t(function(){e.allertFalse=!1,e.allertTrue=!1},2e3)}}]);var ENUM_Queries={getAllTopics:"getTopicAll",checklogin:"chekLogin",selectOneTopic:"selectOneTopic",delTopic:"deleteTopic",delComm:"deleteComment",editTopic:"editTopic",addUser:"addUser",login:"login",logout:"logout",viewComment:"viewComment",putComment:"putComment"},page=0,limit=2,blogServices=angular.module("blogServices",[]);blogServices.factory("requestService",["$http",function(e){var t={};return t.getTopicAll={urlT:"/api/topic",method:"GET",dataType:"json",data:{}},t.chekLogin={urlT:"/api/login/logged",method:"GET"},t.selectOneTopic={urlT:"/api/topic/",method:"GET",dataType:"json"},t.deleteTopic={urlT:"/api/topic/",method:"DELETE"},t.deleteComment={urlT:"/api/comments/",method:"DELETE"},t.editTopic={urlT:"/api/topic/",method:"PUT"},t.addUser={urlT:"/api/login/",method:"PUT",dataType:"json"},t.login={urlT:"/api/login/",method:"POST",dataType:"json"},t.logout={urlT:"/api/login/logout",method:"GET"},t.viewComment={urlT:"/api/comments/",method:"GET",dataType:"json"},t.putComment={urlT:"/api/comments/",method:"PUT"},t.getData=function(o,i,n){return i=i||"",n=n||"",t[o].data=n,t[o].params={page:page,limit:limit},t[o].url=t[o].urlT+i,e(t[o])},t.loadMore=function(o,i,n){return i=i||"",console.log(page),t[o].params={page:page,limit:limit},t[o].url=t[o].url+i,t[o].data=n,e(t[o])},t}]);var loginModule=angular.module("loginModule",["loginServices"]);loginServices=angular.module("loginServices",[]),loginServices.factory("loginService",["requestService","$q",function(e,t){return{login:function(o){var i=t.defer();return e.getData(ENUM_Queries.login,"",o).then(function(e){i.resolve(e)},function(e,t){i.reject(t)}),i.promise},isLogged:function(){var o=t.defer();return e.getData(ENUM_Queries.checklogin).then(function(e){o.resolve(e)},function(e,t){o.reject(t)}),o.promise},logout:function(){var o=t.defer();return e.getData(ENUM_Queries.logout).then(function(e){o.resolve(e)},function(e,t){o.reject(t)}),o.promise},addUser:function(o){var i=t.defer();return e.getData(ENUM_Queries.addUser,"",o).then(function(e){i.resolve(e)},function(e,t){i.reject(t)}),i.promise}}}]),loginModule.controller("loginController",["$scope","$timeout","loginService",function(e,t,o){e.allert={},e.login={username:"",password:""},o.isLogged().then(function(t){e.isLogged=t.data,e.setName(t.data)}),e.isAddUser=!1,e.loginBtn=function(){o.login(e.login).then(function(t){e.isLogged=t.data.username,e.setName(t.data.username),e.login={},e.allert.text="You logged",e.allertTrue=!0},function(t){e.allert.text="Check login/password or register",e.allertFalse=!0}),t(function(){e.allertFalse=!1,e.allertTrue=!1},2e3)},e.logoutBtn=function(){o.logout().then(function(t){e.isLogged=0,e.setName(0)})},e.registerBtn=function(){e.login={username:"",password:""},e.isAddUser=!0},e.addUser=function(){e.login.username&&e.login.password?o.addUser(e.login).then(function(t){e.setAllert(!0,"User added, try login!"),e.login={username:"",password:""},e.isAddUser=!1},function(t){e.allert.text="User exist!",e.allertFalse=!0}):(e.allert.text="Login or password null",e.allertFalse=!0),t(function(){e.allertFalse=!1,e.allertTrue=!1},2e3)}}]);var loginElement=angular.module("loginElement",[]);app.directive("loginLogout",function(){return{scope:!1,restrict:"E",templateUrl:"templates/loginTemplate.html"}});var topicModule=angular.module("topicModule",["topicServices"]);topicServices=angular.module("topicServices",[]),topicServices.factory("topicService",["requestService","$q",function(e,t){return{getAlltopics:function(o,i){var n=t.defer();return e.getData(ENUM_Queries.getAllTopics).then(function(e){n.resolve(e)},function(e,t){n.reject(t)}),n.promise},deleteTopic:function(o){var i=t.defer();return e.getData(ENUM_Queries.delTopic,o).then(function(e){i.resolve(e)},function(e,t){i.reject(t)}),i.promise},selectOneTopic:function(o){var i=t.defer();return e.getData(ENUM_Queries.selectOneTopic,o).then(function(e){i.resolve(e)},function(e,t){i.reject(t)}),i.promise},saveTopic:function(o,i){var n=t.defer();return e.getData(ENUM_Queries.editTopic,o,i).then(function(e){n.resolve(e)},function(e,t){n.reject(t)}),n.promise}}}]),topicModule.controller("topicController",["$scope","$timeout","topicService",function(e,t,o){function i(e){var t={};for(key in e)t[key]=e[key];return t}e.init=function(){e.topic.data=[],page=0,e.viewformat="list",o.getAlltopics(ENUM_Queries.getAllTopics).then(function(t){e.topic.data=t.data})},e.init(),e.loadMore=function(){page++,o.getAlltopics(ENUM_Queries.getAllTopics).then(function(t){e.topic.data=e.topic.data.concat(t.data)},function(){e.topicAllert=!0,t(function(){e.topicAllert=!1},2e3)})},e.deleteTopic=function(t){o.deleteTopic(e.topic.data[t].name).then(function(){e.topic.data.splice(t,1),e.setAllert(!0,"Topic deleted!"),e.init()})},e.viewTopic=function(t){e.thisTopic=i(e.topic.data[t]),e.viewformat="view",o.selectOneTopic(e.topic.data[t].name).then(function(t){e.thisTopic.textFull=t.data.text})},e.back=function(){e.viewformat="list"},e.edit=function(t){e.viewformat="edit",e.thisTopic=i(e.topic.data[t]),e.thisTopic.oldTopic=e.thisTopic.name,o.selectOneTopic(e.thisTopic.name).then(function(t){e.thisTopic.textFull=t.data.text,tinymce.init({width:"100%",height:"100%",selector:"textarea",force_br_newlines:!1,force_p_newlines:!1,forced_root_block:""}),setTimeout(function(){tinyMCE.activeEditor&&tinyMCE.activeEditor.setContent(t.data.text)},300)})},e.SaveTopic=function(){e.thisTopic.text=tinyMCE.activeEditor.getContent({format:"raw"}),e.thisTopic.imgnew&&(e.thisTopic.img=e.thisTopic.imgnew),o.saveTopic(e.thisTopic.name,e.thisTopic).then(function(){e.init()},function(){alert("error")})}}]),app.directive("topicPost",function(){return{restrict:"E",templateUrl:"templates/topicTemplate.html"}});